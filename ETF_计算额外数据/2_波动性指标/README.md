# 📊 波动性指标系统

## 🎯 项目概述
波动性指标主要用于衡量价格波动的幅度和市场的不确定性，帮助投资者评估风险水平和确定合适的仓位管理策略。

## 🏗️ 系统架构
本系统包含三个独立的波动性指标计算子系统，每个子系统都采用六层模块化架构：

### 📁 子系统列表
1. **波动率指标系统** (`波动率指标/`) - 历史波动率计算
2. **布林带系统** (`布林带/`) - 布林带指标计算 
3. **真实波幅系统** (`真实波幅/`) - ATR指标计算

### 🔧 系统架构层次
```
每个子系统/
├── controllers/     # 控制器层 - 业务逻辑控制
├── engines/         # 引擎层 - 核心计算逻辑
├── infrastructure/  # 基础设施层 - 数据读取、缓存、配置
├── interfaces/      # 接口层 - 外部交互接口
├── outputs/         # 输出层 - 结果处理和格式化
└── cache/          # 缓存层 - 智能缓存数据
```

## 📊 指标详细说明

### 1. 波动率指标系统
**设计特点**: 单行最新结果保存
- **vol_10**: 10日波动率 (年化)
- **vol_20**: 20日波动率 (年化)  
- **vol_30**: 30日波动率 (年化)
- **rolling_vol_10**: 10日滚动波动率
- **rolling_vol_30**: 30日滚动波动率
- **price_range**: 价格振幅百分比
- **vol_ratio_20_30**: 20日/30日波动率比率
- **vol_state**: 波动率状态 (LOW/NORMAL/HIGH)
- **vol_level**: 波动率水平 (LOW/MEDIUM/HIGH)

### 2. 布林带系统
**设计特点**: 历史时间序列数据保存
- **bb_middle**: 20日简单移动平均线
- **bb_upper**: 中轨 + 2倍标准差
- **bb_lower**: 中轨 - 2倍标准差
- **bb_width**: (上轨-下轨)/中轨 × 100
- **bb_position**: 价格在布林带中的位置
- **bb_signal**: 布林带交易信号

### 3. 真实波幅系统 (ATR)
**设计特点**: 历史时间序列数据保存
- **tr**: 真实波幅 = MAX(高-低, |高-昨收|, |低-昨收|)
- **atr_10**: 10日平均真实波幅
- **atr_percent**: ATR百分比
- **atr_change_rate**: ATR变化率
- **atr_ratio_hl**: ATR与最高最低价比率
- **stop_loss**: 动态止损位
- **volatility_level**: 波动率水平 (低/中/高)

## 🚨 重要设计差异说明

### 数据保存模式
- **波动率指标系统**: 每个ETF文件只保存**最新的单行计算结果**
- **布林带系统**: 每个ETF文件保存**完整的历史时间序列数据**
- **ATR系统**: 每个ETF文件保存**完整的历史时间序列数据**

### 文件命名规则
- **波动率指标**: `159201.csv` (不含交易所后缀)
- **布林带**: `159201.csv` (不含交易所后缀)
- **ATR**: `159201SZ.csv` (含交易所后缀)

## 📈 数据完整性状态

### ✅ 完全可用系统
- **ATR真实波幅系统**: 661个3000万门槛文件 + 453个5000万门槛文件
- **布林带系统**: 1158个文件，数据完整

### ⚠️ 特殊设计系统
- **波动率指标系统**: 529个文件，单行最新结果（符合设计）

## 🔄 使用方式

### 运行单个系统
```bash
# 波动率指标系统
cd 波动率指标/
python volatility_main.py --threshold 3000万门槛 --batch

# 布林带系统  
cd 布林带/
python bb_main.py --threshold 3000万门槛 --batch

# ATR系统
cd 真实波幅/
python atr_main.py --threshold 3000万门槛 --batch
```

### 检查系统状态
```bash
python [系统名]_main.py --status
```

## 📊 Meta文件标准
每个系统都生成标准化的meta文件：
- `3000万门槛_meta.json` - 3000万门槛统计信息
- `5000万门槛_meta.json` - 5000万门槛统计信息
- `system_meta.json` - 系统全局信息

## 🎯 技术特性

### 共同特性
- **8位小数精度**: 所有计算结果统一8位小数
- **小写字段命名**: 与趋势指标系统保持一致
- **智能缓存**: 96%+缓存命中率，支持增量更新
- **双门槛支持**: 3000万门槛和5000万门槛
- **向量化计算**: 高性能批量处理
- **异常处理**: 完善的错误处理机制

### 性能指标
- **缓存命中率**: 96%以上
- **计算效率**: 98.5%以上
- **批量处理**: 支持500+ETF同时计算
- **增量更新**: 支持智能数据更新

## 🔧 配置参数

### 通用配置
```json
{
  "precision": 8,
  "enable_cache": true,
  "batch_size": 50,
  "thresholds": ["3000万门槛", "5000万门槛"]
}
```

### 系统专用配置
- **波动率**: 支持年化计算、周期配置
- **布林带**: 支持多参数集、短周期计算
- **ATR**: 支持止损倍数、波动率阈值配置

## 🚀 应用场景

### 1. 风险管理
- **止损设置**: 基于ATR设置动态止损位
- **仓位控制**: 根据波动性调整仓位大小
- **风险预警**: 波动率异常时的风险提示

### 2. 交易信号
- **布林带策略**: 价格触及上下轨的买卖信号
- **波动率突破**: 低波动后的突破交易机会
- **ATR通道交易**: 在价格通道内的震荡交易

### 3. 市场状态判断
- **市场情绪**: 高波动率通常对应恐慌或兴奋情绪
- **趋势强度**: 波动率与趋势方向的配合程度
- **转折预警**: 波动率极值往往预示趋势转折

## 📋 维护指南

### 日常维护
1. **数据更新**: 每日运行批量计算
2. **缓存清理**: 定期清理过期缓存
3. **性能监控**: 监控计算效率和成功率
4. **错误处理**: 及时处理计算异常

### 故障排除
1. **检查数据源**: 确保ETF日K数据完整
2. **验证配置**: 检查参数配置是否正确
3. **缓存重建**: 必要时清空缓存重新计算
4. **日志分析**: 查看详细错误日志

## 💡 最佳实践

### 组合使用建议
- **波动性 + 趋势**: 结合趋势指标确定交易方向
- **波动性 + 动量**: 结合动量指标把握入场时机
- **波动性 + 成交量**: 结合成交量确认突破有效性

### 参数优化
- **回测验证**: 通过历史数据验证参数有效性
- **市场适应**: 根据市场环境调整计算参数
- **风险控制**: 设置合理的波动率阈值

## 🔥 优先级说明
波动性指标是风险管理的核心工具，建议优先实现和维护。

---

*更新时间: 2025-07-14*  
*版本: v2.0.0*