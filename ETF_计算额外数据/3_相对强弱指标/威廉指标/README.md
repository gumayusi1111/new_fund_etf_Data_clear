# 威廉指标 (Williams %R)

## 指标概述
威廉指标(%R)由拉里·威廉姆斯开发，是一个动量振荡器，用于确定证券的超买和超卖状态。与RSI相似但计算方法不同，%R更关注价格在特定时期内的相对位置。

## 包含指标

### 核心威廉指标
- **WR14**: 14日威廉指标 - 标准周期
- **WR21**: 21日威廉指标 - 月度周期  
- **WR9**: 9日威廉指标 - 短期周期

### 衍生指标
- **WR_Fast**: 快速威廉指标 (6日)
- **WR_Slow**: 慢速威廉指标 (28日)
- **WR_Signal**: 威廉指标信号标识

## 计算公式

### 基础计算
```
%R = (最高价 - 收盘价) / (最高价 - 最低价) × (-100)

其中：
最高价 = N日内最高价
最低价 = N日内最低价
收盘价 = 当日收盘价

取值范围：-100 到 0
```

### 标准化威廉指标
```
%R标准化 = |%R|  (取绝对值，范围0-100)
这样便于理解：100为超买，0为超卖
```

## 应用策略

### 1. 超买超卖策略
- **%R > -20**: 超买区域，考虑卖出
- **%R < -80**: 超卖区域，考虑买入
- **%R = -50**: 中性区域

### 2. 威廉指标形态
- **双底**: %R在超卖区形成双底，看涨信号
- **双顶**: %R在超买区形成双顶，看跌信号
- **失败摆动**: 超买超卖区域的失败摆动

### 3. 背离分析
- **顶背离**: 价格创新高，%R不创新高(更接近0)
- **底背离**: 价格创新低，%R不创新低(更接近-100)

### 4. 突破策略
- **突破-20**: %R从超买区突破-20线向下
- **突破-80**: %R从超卖区突破-80线向上

## 信号强度分级

### 强信号
- **极值反转**: %R从-5以上回落或从-95以下反弹
- **背离确认**: 与价格明显背离
- **形态完成**: 双顶双底等形态确认

### 中等信号
- **常规超买超卖**: 在-20和-80区域的信号
- **趋势跟随**: %R方向与价格趋势一致

### 弱信号
- **中性区震荡**: %R在-20到-80之间震荡
- **无明确方向**: %R横盘整理

## 参数设置建议

### 短期参数 (WR9)
- **适用**: 日内交易、短线操作
- **特点**: 敏感度高，信号频繁
- **阈值**: 超买>-15, 超卖<-85

### 标准参数 (WR14)
- **适用**: 一般交易策略
- **特点**: 平衡敏感性和可靠性
- **阈值**: 超买>-20, 超卖<-80

### 长期参数 (WR21/WR28)
- **适用**: 中长期投资
- **特点**: 信号稳定，假信号少
- **阈值**: 超买>-25, 超卖<-75

## 与RSI对比

### 相似点
- 都是动量振荡器
- 都有超买超卖概念
- 都可以进行背离分析

### 差异点
- **计算方法**: %R基于价格位置，RSI基于涨跌幅
- **取值范围**: %R是-100到0，RSI是0到100
- **敏感性**: %R通常比RSI更敏感
- **平滑度**: RSI相对更平滑

## 实战应用技巧

### 1. 多时间框架分析
```python
# 多周期威廉指标确认
def wr_multi_timeframe(data):
    wr_9 = calculate_wr(data, 9)
    wr_14 = calculate_wr(data, 14) 
    wr_21 = calculate_wr(data, 21)
    
    # 全部超卖
    if wr_9 < -80 and wr_14 < -80 and wr_21 < -80:
        return "强烈超卖"
    # 全部超买
    elif wr_9 > -20 and wr_14 > -20 and wr_21 > -20:
        return "强烈超买"
    else:
        return "中性区域"
```

### 2. 背离检测
```python
def wr_divergence_detection(prices, wr, lookback=10):
    price_peaks = find_peaks(prices, lookback)
    wr_peaks = find_peaks(wr, lookback)
    
    # 顶背离
    if (prices[price_peaks[-1]] > prices[price_peaks[-2]] and
        wr[wr_peaks[-1]] < wr[wr_peaks[-2]]):
        return "顶背离"
    
    # 底背离
    price_lows = find_lows(prices, lookback)
    wr_lows = find_lows(wr, lookback)
    
    if (prices[price_lows[-1]] < prices[price_lows[-2]] and
        wr[wr_lows[-1]] > wr[wr_lows[-2]]):
        return "底背离"
    
    return "无背离"
```

### 3. 入场时机选择
```python
def wr_entry_signals(wr, prices, volume):
    current_wr = wr[-1]
    prev_wr = wr[-2]
    
    # 买入信号
    if (current_wr > -80 and prev_wr <= -80 and 
        volume[-1] > volume[-5:-1].mean()):
        return "买入信号"
    
    # 卖出信号  
    elif (current_wr < -20 and prev_wr >= -20 and
          volume[-1] > volume[-5:-1].mean()):
        return "卖出信号"
    
    return "等待信号"
```

## 市场环境适应性

### 震荡市场 ✅
- **效果**: 威廉指标在震荡市表现最佳
- **策略**: 高抛低吸，区间操作
- **成功率**: 相对较高

### 趋势市场 ⚠️
- **问题**: 容易出现钝化现象
- **解决**: 结合趋势指标过滤
- **调整**: 修改超买超卖阈值

### 突破行情 ✅
- **确认**: 突破配合%R极值反转
- **验证**: %R背离预示突破方向

## 组合使用建议

### %R + RSI
- **双重确认**: 两个指标同时超买超卖
- **分歧分析**: 两指标出现分歧时的处理

### %R + MACD
- **时机选择**: %R选择价位，MACD选择时机
- **趋势确认**: MACD确认趋势方向

### %R + 成交量
- **信号验证**: 极值%R需要成交量配合
- **突破确认**: 量价配合的%R信号

## 常见误区

### 1. 机械化使用
- **错误**: 严格按-20/-80操作
- **正确**: 根据市场环境调整阈值

### 2. 忽略趋势
- **错误**: 在强趋势中逆势操作
- **正确**: 结合趋势方向操作

### 3. 单独使用
- **错误**: 仅凭%R做交易决策
- **正确**: 与其他指标组合验证

## 优化建议

### 动态阈值
```python
# 根据市场波动性调整阈值
def dynamic_wr_levels(atr, base_overbought=-20, base_oversold=-80):
    volatility_factor = atr / atr.rolling(252).mean()
    
    overbought = base_overbought * volatility_factor
    oversold = base_oversold * volatility_factor
    
    return min(overbought, -10), max(oversold, -90)
```

## 适用场景
- ✅ 震荡市场的反转交易
- ✅ 超买超卖状态识别
- ✅ 短期交易时机把握
- ✅ 与其他指标组合验证

## 输出字段
- `WR_14`: 14日威廉指标
- `WR_21`: 21日威廉指标
- `WR_9`: 9日威廉指标
- `WR_Signal`: 威廉指标信号 (1=看涨, -1=看跌, 0=中性)
- `WR_OverboughtOversold`: 超买超卖状态标识
- `WR_Divergence`: 背离信号标识 