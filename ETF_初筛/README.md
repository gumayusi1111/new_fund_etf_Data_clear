# ETF初筛系统

## 🎯 **系统概述**

基于ETF日更数据的智能筛选系统，通过11个核心字段进行多维度筛选，从大量ETF中筛选出优质标的。

### **核心特性**
- 🔒 **只读数据源** - 严格不修改日更数据，仅读取分析
- 🎛️ **模块化设计** - 高内聚低耦合，易于维护和扩展
- 📊 **三种复权支持** - 前复权、后复权、除权数据同步处理
- 🔍 **多维度筛选** - 质量、成交量、趋势三大维度评估
- ⚡ **智能评分** - 综合加权评分，精准识别优质ETF
- 💾 **完整输出** - 保持与日更相同的目录结构

## 📁 **系统架构**

```
ETF_初筛/
├── 📁 src/                          # 核心源码模块
│   ├── __init__.py                  # 包初始化
│   ├── data_loader.py               # 数据加载器 (只读)
│   ├── 📁 filters/                  # 筛选器模块
│   │   ├── base_filter.py           # 基础筛选器
│   │   ├── volume_filter.py         # 成交量筛选器
│   │   ├── trend_filter.py          # 趋势筛选器
│   │   └── quality_filter.py        # 质量筛选器
│   ├── 📁 processors/               # 数据处理器
│   │   ├── data_processor.py        # 主数据处理器
│   │   └── output_manager.py        # 输出管理器
│   └── 📁 utils/                    # 工具模块
│       ├── config.py                # 配置管理器
│       └── logger.py                # 日志管理器
├── 📁 config/                       # 配置文件
│   └── filter_config.json          # 筛选配置
├── 📁 data/                         # 筛选结果输出
│   ├── 0_ETF日K(前复权)/           # 前复权筛选结果
│   ├── 0_ETF日K(后复权)/           # 后复权筛选结果
│   ├── 0_ETF日K(除权)/             # 除权筛选结果
│   └── reports/                     # 筛选报告
├── 📁 logs/                         # 日志文件
├── 🚀 main.py                       # 主入口文件
└── 📖 README.md                     # 使用文档
```

## 🎛️ **筛选器体系**

### **1. 质量筛选器 (权重: 40%)**
- ✅ **连续跌停检查** - 最大连续跌停天数限制
- ✅ **价格合理性** - 最小有效价格过滤
- ✅ **异常波动控制** - 异常涨跌幅比例限制
- ✅ **数据完整性** - 数据缺失率验证

### **2. 成交量筛选器 (权重: 35%)**
- 📊 **基础流动性** - 最小平均成交量、成交额
- 📊 **成交量稳定性** - 变异系数分析
- 📊 **交易活跃度** - 零成交量天数控制
- 📊 **量价一致性** - 成交量合理性验证

### **3. 趋势筛选器 (权重: 25%)**
- 📈 **风险控制** - 夏普比率、最大回撤限制
- 📈 **技术指标** - RSI、MACD、均线分析
- 📈 **趋势强度** - 价格趋势方向和强度
- 📈 **收益表现** - 年化收益率、胜率评估

## 🚀 **快速开始**

### **1. 系统测试**
```bash
# 测试系统完整性
python main.py --mode test

# 查看配置信息
python main.py --mode config
```

### **2. 全量筛选**
```bash
# 筛选所有ETF (前复权)
python main.py --mode all

# 筛选所有ETF (后复权)
python main.py --mode all --fuquan-type "0_ETF日K(后复权)"

# 筛选最近60天数据
python main.py --mode all --days-back 60

# 保存所有三种复权结果
python main.py --mode all --save-all-fuquan
```

### **3. 指定ETF筛选**
```bash
# 筛选指定ETF
python main.py --mode specific --codes 159001 159003 159005

# 仅输出结果，不保存文件
python main.py --mode specific --codes 159001 --output-only
```

## ⚙️ **配置说明**

### **筛选条件配置** (`config/filter_config.json`)

```json
{
  "筛选条件": {
    "基础条件": {
      "最小交易天数": 60,           // 最少需要60天交易数据
      "最小平均成交量_手": 1000,    // 日均成交量不少于1000手
      "最小平均成交额_千元": 50000  // 日均成交额不少于5000万
    },
    "质量条件": {
      "最大连续跌停天数": 3,        // 连续跌停不超过3天
      "最小有效价格": 0.5,          // 价格不低于0.5元
      "最大异常涨跌幅": 15.0         // 异常涨跌幅不超过15%
    },
    "趋势条件": {
      "最小相对强度": 0.3,          // 相对强度不低于0.3
      "最大回撤限制": 0.3,          // 最大回撤不超过30%
      "最小夏普比率": 0.1           // 夏普比率不低于0.1
    }
  }
}
```

## 📊 **评分机制**

### **综合评分计算**
- **质量筛选**: 40% 权重
- **成交量筛选**: 35% 权重  
- **趋势筛选**: 25% 权重

### **通过标准**
- 🎯 **完全通过**: 所有筛选器得分 ≥ 60分
- 🎯 **候选ETF**: 至少2个筛选器通过
- 🎯 **排序规则**: 按综合加权得分降序

## 📈 **输出结果**

### **1. 数据文件**
- 筛选通过的ETF保存到 `data/` 对应复权目录
- 保持与日更相同的CSV格式和字段结构
- 支持自定义保留天数 (默认252天)

### **2. 筛选报告**
- JSON格式的详细筛选报告
- 包含各筛选器得分和通过情况
- 统计信息和处理摘要

### **3. 日志记录**
- 完整的筛选过程日志
- 错误诊断和性能统计
- 支持日志轮转和大小控制

## 🔧 **技术指标**

### **已实现的核心指标**
基于ETF技术指标计算手册，系统已实现：

- **趋势指标**: SMA、EMA、MACD系统
- **相对强弱**: RSI、威廉指标
- **波动性**: 标准差、最大回撤、夏普比率
- **成交量**: 成交量均值、稳定性、活跃度
- **风险度量**: 年化波动率、VaR、胜率

### **计算公式举例**
```python
# 夏普比率 = (年化收益率 - 无风险利率) / 年化波动率
夏普比率 = (年化收益率 - 3) / 年化波动率

# 最大回撤 = MAX((峰值 - 谷值) / 峰值)
最大回撤 = ((累计净值 / 累计最高点) - 1).min()

# RSI = 100 - (100 / (1 + RS))
# RS = 平均上涨幅度 / 平均下跌幅度
```

## 🛠️ **高级功能**

### **1. 自定义筛选器**
```python
# 继承BaseFilter创建新筛选器
class CustomFilter(BaseFilter):
    def filter_single_etf(self, etf_code: str, df: pd.DataFrame) -> FilterResult:
        # 实现自定义筛选逻辑
        pass
```

### **2. 批量处理**
- 支持多线程数据加载
- 智能内存管理
- 增量更新机制

### **3. 扩展性**
- 模块化筛选器架构
- 可配置权重系统
- 插件式功能扩展

## 📚 **API接口**

### **主要类和方法**

```python
# 数据加载器
data_loader = ETFDataLoader()
etf_codes = data_loader.get_available_etf_codes("0_ETF日K(前复权)")
etf_data = data_loader.load_etf_data("159001", "0_ETF日K(前复权)")

# 数据处理器
processor = ETFDataProcessor()
results = processor.process_all_etfs("0_ETF日K(前复权)")

# 输出管理器
output_manager = OutputManager()
output_manager.save_filtered_results(results, etf_data, "0_ETF日K(前复权)")
```

## 🎯 **使用场景**

### **1. 日常筛选**
- 每日自动筛选新增ETF
- 定期更新筛选结果
- 监控ETF质量变化

### **2. 专项分析**
- 特定主题ETF筛选
- 不同时间窗口分析
- 风险特征对比

### **3. 系统集成**
- 与现有系统无缝对接
- 支持API调用
- 数据格式兼容

## ⚠️ **重要提醒**

1. **数据安全**: 系统严格遵循只读原则，绝不修改日更源数据
2. **路径依赖**: 确保日更数据路径配置正确
3. **资源消耗**: 全量筛选可能需要较多内存，建议分批处理
4. **参数调优**: 根据实际需求调整筛选条件参数

## 🆕 **版本历史**

- **v1.0.0** - 初始版本，实现基础筛选功能
- 支持三种复权数据处理
- 完整的模块化架构
- 智能评分和排序机制

---

**💡 提示**: 系统设计遵循高内聚低耦合原则，每个模块职责明确，便于维护和扩展。如需自定义筛选逻辑，建议参考现有筛选器实现。 